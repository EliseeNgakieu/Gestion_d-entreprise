<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion d'Entreprise - Liste des Employés</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const Edit = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" {...props}>
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M16.862 4.487l1.687-1.688a2.25 2.25 0 113.182 3.182L7.5 20.313 3 21l.688-4.5L16.862 4.487z" />
            </svg>
        );

        const Trash2 = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" {...props}>
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7V5a2 2 0 012-2h2a2 2 0 012 2v2m-7 0h8" />
            </svg>
        );

        const Info = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" {...props}>
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M13 16h-1v-4h-1m1-4h.01M12 3a9 9 0 100 18 9 9 0 000-18z" />
            </svg>
        );

        function Button({ children, className = "", onClick }) {
            return (
                <button
                    className={`px-3 py-2 rounded-lg text-sm font-medium border transition-all hover:shadow ${className}`}
                    onClick={onClick}
                >
                    {children}
                </button>
            );
        }

        function Card({ children }) {
            return (
                <div className="border-2 border-green-100 rounded-2xl shadow-lg bg-white">{children}</div>
            );
        }

        function CardContent({ children }) {
            return <div className="p-5">{children}</div>;
        }

        function EmployeeList() {
            const [employees, setEmployees] = useState([]);

            useEffect(() => {
                const loadEmployees = () => {
                    try {
                        const stored = JSON.parse(localStorage.getItem("employees") || "[]");
                        setEmployees(stored);
                    } catch (error) {
                        console.error("Erreur lors du chargement des employés :", error);
                        setEmployees([]);
                    }
                };

                loadEmployees();
                window.addEventListener("storage", loadEmployees);

                return () => window.removeEventListener("storage", loadEmployees);
            }, []);

            const saveEmployees = (updated) => {
                setEmployees(updated);
                localStorage.setItem("employees", JSON.stringify(updated));
            };

            const handleDelete = (id) => {
                if (!confirm("Supprimer cet employé ?")) return;
                const updated = employees.filter((emp) => emp.id !== id);
                saveEmployees(updated);
            };

            const handleEdit = (id) => {
                window.location.href = `Modifier.html?id=${id}`;
            };

            const handleDetails = (employee) => {
                alert(
                    [
                        `Nom : ${employee.fullName}`,
                        `Poste : ${employee.jobTitle || "Non renseigné"}`,
                        `Département : ${employee.department || "Non renseigné"}`,
                        `Email : ${employee.email || "Non renseigné"}`,
                    ].join("\n")
                );
            };

            return (
                <div className="min-h-screen bg-gradient-to-b from-green-50 to-white p-8">
                    <h1 className="text-4xl font-bold text-green-700 mb-6 text-center">Liste des Employés</h1>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {employees.map((employee) => (
                            <Card key={employee.id}>
                                <CardContent>
                                    <div className="flex items-center gap-4 mb-4">
                                        <div className="w-16 h-16 rounded-full overflow-hidden border border-green-200 bg-green-50 flex items-center justify-center">
                                            {employee.photo ? (
                                                <img src={employee.photo} alt={employee.fullName} className="w-full h-full object-cover" />
                                            ) : (
                                                <span className="text-xs text-green-500 text-center px-2">Pas de photo</span>
                                            )}
                                        </div>
                                        <div>
                                            <p className="text-lg font-semibold text-green-800">{employee.fullName}</p>
                                            <p className="text-sm text-green-600">{employee.jobTitle || "Poste non renseigné"}</p>
                                        </div>
                                    </div>
                                    <p className="text-sm text-green-500">Département : {employee.department || "Non renseigné"}</p>
                                    <p className="text-sm text-green-500 mb-4">Email : {employee.email || "Non renseigné"}</p>
                                    <div className="flex flex-wrap gap-2 justify-end">
                                        <Button className="border-green-600 text-green-700 flex items-center gap-1" onClick={() => handleEdit(employee.id)}>
                                            <Edit className="w-4 h-4" /> Modifier
                                        </Button>
                                        <Button className="border-red-500 text-red-600 flex items-center gap-1" onClick={() => handleDelete(employee.id)}>
                                            <Trash2 className="w-4 h-4" /> Supprimer
                                        </Button>
                                        <Button className="border-blue-500 text-blue-600 flex items-center gap-1" onClick={() => (window.location.href = `details.html?id=${employee.id}`)}>
                                            <Info className="w-4 h-4" /> Détails
                                        </Button>
                                    </div>
                                </CardContent>
                            </Card>
                        ))}

                        {employees.length === 0 && (
                            <div className="col-span-full text-center text-green-600 bg-green-50 border border-dashed border-green-200 rounded-xl py-10">
                                Les fiches employés apparaîtront ici dès qu'un employé aura été ajouté.
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<EmployeeList />);
    </script>
</body>
</html>
